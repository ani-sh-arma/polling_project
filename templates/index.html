{% extends 'base.html' %} {% block style %}
<style>
  .parent {
    height: fit-content;
    width: 100%;
    display: flex;
    justify-content: center;
    padding: 20px 0;
  }
  .wrapper {
    display: grid;
    gap: 30px;
    grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
    width: 90%;
    max-width: 1200px;
  }
  .pollContent {
    border: 1px solid #e0e0e0;
    border-radius: 0.75rem;
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
    transition: transform 0.2s ease-in-out;
  }
  .pollContent:hover {
    transform: translateY(-5px);
  }
  .pollContent .card-title {
    font-size: 1.5rem;
    margin-bottom: 15px;
    color: #333;
  }
  .pollContent weak {
    font-size: 0.85rem;
    color: #6c757d;
    display: flex;
    justify-content: space-between;
    margin-bottom: 15px;
  }
  .options {
    display: block;
    width: 100%;
    padding: 10px 15px;
    margin-bottom: 8px;
    border: 1px solid #007bff;
    border-radius: 0.5rem;
    color: #007bff;
    text-decoration: none;
    transition: all 0.2s ease-in-out;
    background-color: #fff;
    display: flex;
    justify-content: space-between;
    align-items: center;
  }
  .options:hover {
    background-color: #007bff;
    color: white;
  }
  .options p {
    margin: 0;
    font-weight: bold;
  }
  .err {
    color: #dc3545;
    font-size: 0.9rem;
    margin-bottom: 10px;
  }
</style>
{% endblock style %} {% block serach_bar %}
<div class="d-flex justify-content-center my-3">
  <form action="" class="d-flex" style="width: 100%; max-width: 500px;">
    <input
      type="text"
      id="search"
      name="search"
      class="form-control me-2"
      placeholder="Search polls..."
      aria-label="Search"
    />
    <button type="submit" class="btn btn-outline-primary">Search</button>
  </form>
</div>
{% endblock serach_bar %} {% block body %}
<section class="container-fluid">
  <div class="wrapper">
    {% for poll in polls %}
    <div class="card pollContent poll p-3">
      <div id="errorBox_{{ poll.id }}" class="err"></div>
      <h5 class="card-title">{{poll.question}}</h5>
      <weak>
        <span>Created by: {{poll.creator}}</span>
        <span>Date: {{poll.pub_date}}</span>
      </weak>
      <div class="mt-3">
        {% for choice in poll.choice_set.all %}
        <a
          href="/vote/{{choice.id}}"
          class="vote-link"
          data-poll-id="{{ poll.id }}"
        >
          <div
            name="answer1"
            class="options vote-button"
            data-choice-id="{{ choice.id }}"
          >
            <span>{{choice.option_text}}</span>
            <p id="vote_count">{{choice.votes}}</p>
          </div>
        </a>
        {% endfor %}
      </div>
    </div>
    {% endfor %}
  </div>

  <!-- Add this to your HTML template -->
  <script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>

  <script>
    // Function to retrieve a cookie by name
    function getCookie(name) {
      var cookieValue = null;
      if (document.cookie && document.cookie !== "") {
        var cookies = document.cookie.split(";");
        for (var i = 0; i < cookies.length; i++) {
          var cookie = cookies[i].trim();
          // Check if this cookie name is the one we are looking for
          if (cookie.substring(0, name.length + 1) === name + "=") {
            cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
            break;
          }
        }
      }
      return cookieValue;
    }

    document.addEventListener("DOMContentLoaded", () => {
      $(document).ready(function () {
        $(".vote-link").on("click", function (event) {
          event.preventDefault();
          var pollId = $(this).data("poll-id");
          var choiceId = $(this).find(".options").data("choice-id");

          // Save a reference to the clicked element
          var clickedOption = $(this).find(".options");

          // Send an AJAX request to the server to record the vote
          $.ajax({
            type: "POST",
            url: `/vote/${choiceId}/`,
            headers: {
              "X-CSRFToken": getCookie("csrftoken"),
            },
            success: function (data) {
              if (data.error) {
                //alert(data.error);
                $(`#errorBox_${pollId}`).text(data.error);

                setTimeout(() => {
                  $(`#errorBox_${pollId}`).text("");
                }, 10000);
              } else {
                // Add a class to the clicked element
                clickedOption.addClass("voted-option");

                // Update the content and background color
                clickedOption.find("p").text(data.votes);
                clickedOption.css("background-color", "grey");
              }
            },
            error: function (error) {
              console.error("Error:", error);
            },
          });
        });
      });
    });
  </script>
</section>
{% endblock body %}
